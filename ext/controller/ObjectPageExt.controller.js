/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["i2d/qm/inspsubset/resultsrecords1/ext/formatter/Formatters","sap/m/MessageToast","sap/i2d/qm/lib/resultsrecords1/customcontrol/CodeGroupInput","sap/i2d/qm/lib/resultsrecords1/controller/rr.controller"],function(F,M,C,r){"use strict";return sap.ui.controller("i2d.qm.inspsubset.resultsrecords1.ext.controller.ObjectPageExt",{CodeGroup:C,RR:r,oSavePayloadKeys:{ignoreKeys:["InspSpecIsQuantitative","InspectionSpecificationText","HasInspCharcPrtlSmpl","InspCharacteristicSampleUnit","QuantityUnit","InspLotTestEquipInternalID","InspectionScope","InspectionMethod","InspectionMethodText","InspSpecDecimalPlaces","InspSpecHasTargetValue","InspSpecHasUpperLimit","InspSpecHasLowerLimit","InspectionMethodPlant","InspectionSpecification","InspectionMethodVersion","InspCharacteristicSampleSize","InspSpecSampleQuantityFactor","InspSpecControlIndicators","InspSpecIsMeasuredValueRqd","InspSpecTargetValue","InspSpecUpperLimit","InspSpecLowerLimit","InspectionSpecificationUnit","UnitOfMeasureTechnicalName","InspectionSpecificationPlant","InspectionSpecificationVersion","SelectedCodeSet","SelectedCodeSetText","InspectionResultAttributeText","CharacteristicAttributeCodeTxt","InspectionNonconformingRatio","InspResultValueCount","InspSpecImportanceCode","InspSpecImportanceCodeText","InspResultIsDocumentationRqd","InspCharAcceptedCount","InspCharRejectedCount","InspectionResultStatusText","CharcStatusName","SiblingEntity","to_History","to_InspCharcSubsetResults","to_InspectionResultValue","to_ResultDetails","InspectionValuationResultText","IsEditable","ValuationErrorMessage","IsQual","decimalPlaces","IsSum","IsWithCode","IsMeasure","IsUpper","IsLower","HasTarget","TemplateId","RemarkErrorMessage","IsDataChanged","CodeGroupCodeValuation","CodeGroupCodeErrorMessage"]},inspectionPointPageId:"i2d.qm.inspsubset.resultsrecords1::sap.suite.ui.generic.template.ObjectPage.view.Details::C_InspLotRsltRec",resultRecordingPageId:"i2d.qm.inspsubset.resultsrecords1::sap.suite.ui.generic.template.ObjectPage.view.Details::C_InspSubsetRsltRec",onInit:function(e){var t=this;if(this.getView().getId()===t.inspectionPointPageId){this._ignoreFieldsForSmartTable();}else{this.extensionAPI.registerMessageFilterProvider(t._errorMessageFunction,t);}this.extensionAPI.attachPageDataLoaded(function(e){if(e.context.sPath.indexOf("InspPlanOperationInternalID")>=0){sap.ui.getCore().getMessageManager().removeAllMessages();t._getRRData(e.context);}else{var s=t.getView().byId("inspectionPointSmartTable");if(s){s.rebindTable();}}if(sap.ui.getCore().byId(t.resultRecordingPageId)){var o=sap.ui.getCore().byId(t.resultRecordingPageId);var a=o.getController();if(a.IpSaved===true){M.show(t.getOwnerComponent().getModel("i18n|sap.suite.ui.generic.template.ObjectPage|C_InspSubsetRsltRec").getResourceBundle().getText("MSG_CHANGES_SAVED"));a.IpSaved=false;}else if(a.IpDeleted===true){M.show(t.getOwnerComponent().getModel("i18n|sap.suite.ui.generic.template.ObjectPage|C_InspSubsetRsltRec").getResourceBundle().getText("MSG_CHANGES_DELETED"));a.IpDeleted=false;}}},t);},onBeforeRendering:function(){var p=sap.ui.getCore().byId(this.createId("to_InspSubsetRsltRec::com.sap.vocabularies.UI.v1.LineItem::Section"));if(p){p.addStyleClass("sapUiNoMarginTop");}},_errorMessageFunction:function(){var f=[];var o=new sap.ui.model.Filter("message",sap.ui.model.FilterOperator.NE,"");f.push(o);return f;},onPressValuationHistory:function(e){if(!this.valuationHistoryDialog){this.valuationHistoryDialog=sap.ui.xmlfragment("valuationHistoryDialog","i2d.qm.inspsubset.resultsrecords1.ext.fragment.valuationHistory",this);this.getView().addDependent(this.valuationHistoryDialog);}this.valuationHistoryDialog.setBindingContext(e.getSource().getBindingContext());this.valuationHistoryDialog.open();},onCloseValuationHistory:function(e){this.valuationHistoryDialog.close();},_createIP:function(d,v,e){this.oViewData=v;var t=this;var D={DraftUUID:d.DraftUUID,IsActiveEntity:false,InspectionLotForEdit:d.InspectionLot,InspectionOperationForEdit:d.InspPlanOperationInternalID,InspectionSubsetDate:d.InspectionSubsetDate,InspectionSubsetTime:d.InspectionSubsetTime,InspectionOperations:d.InspectionOperation,InspSubsetStatus:d.InspSubsetStatus,WorkCenter:d.WorkCenter,InspSubsetAcceptedCount:d.InspSubsetAcceptedCount,InspSubsetRejectedCount:d.InspSubsetRejectedCount};sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().getModel().create("/C_InspSubsetRsltRec",D,{success:$.proxy(function(R){sap.ui.core.BusyIndicator.hide();this._navigateToResultRecordingPage(R,t.oViewData,false);},this),error:$.proxy(function(E){sap.ui.core.BusyIndicator.hide();this._showErrorMessage(E);},this)});},_onEditIP:function(d,v){this.oViewData=v;var t=this;sap.ui.core.BusyIndicator.show(0);var u={InspectionLot:d.InspectionLot,InspectionSubsetInternalID:d.InspectionSubsetInternalID,InspPlanOperationInternalID:d.InspPlanOperationInternalID,DraftUUID:d.DraftUUID,IsActiveEntity:d.IsActiveEntity};var p=this.extensionAPI.invokeActions("/C_InspSubsetRsltRecEdit",[],u);p.then(function(R){sap.ui.core.BusyIndicator.hide();t._navigateToResultRecordingPage(R[0].response.data,t.oViewData,false);},function(e){sap.ui.core.BusyIndicator.hide();});},_getRRData:function(c){var d=this.getOwnerComponent().getModel().sServiceUrl;sap.ui.core.BusyIndicator.show(0);var t=this;var V=this.byId("resultsRecordLibraryView");if(V){var a=V.createId("QR_RR_CHARAC_TABLE");this.oController=V.getController();}var o=c.getObject();var b=this.getOwnerComponent().getModel().createKey("C_InspSubsetRsltRec",{InspectionLot:o.InspectionLot,InspectionSubsetInternalID:o.InspectionSubsetInternalID,InspPlanOperationInternalID:o.InspPlanOperationInternalID,DraftUUID:o.DraftUUID,IsActiveEntity:o.IsActiveEntity});var e="/"+b;this.getOwnerComponent().getModel().read(e,{urlParameters:{"$expand":"to_InspSubsetCharcResult,to_InspSubsetCharcResult/to_InspectionResultValue,to_ValuationCodes"},success:(function(R){if(!this.oValuationFacetModel){this.oValuationFacetModel=new sap.ui.model.json.JSONModel();this.getView().setModel(this.oValuationFacetModel,"valuationFacet");}this.oValuationFacetModel.setData(R.to_ValuationCodes);var f=R.to_InspSubsetCharcResult;f.results.forEach(function(i){if(i.IsActiveEntity===true){i.Displayonly="X";}if(i.InspectionResultStatus==="0"){i.InspectionResultStatusText=i.CharcStatusName;}if(i.InspResultValidValuesNumber===0||i.InspResultValidValuesNumber===""||i.InspResultValidValuesNumber===null){i.InspResultValidValuesNumber=0;}else{i.InspResultValidValuesNumber=parseFloat(i.InspResultValidValuesNumber);}switch(i.InspectionValuationResult){case"A":i.InspectionValuationResultText=this.getOwnerComponent().getModel("i18n|sap.suite.ui.generic.template.ObjectPage|C_InspLotRsltRec").getResourceBundle().getText("Accept");break;case"R":i.InspectionValuationResultText=this.getOwnerComponent().getModel("i18n|sap.suite.ui.generic.template.ObjectPage|C_InspLotRsltRec").getResourceBundle().getText("Reject");break;case"F":i.InspectionValuationResultText=this.getOwnerComponent().getModel("i18n|sap.suite.ui.generic.template.ObjectPage|C_InspLotRsltRec").getResourceBundle().getText("Failed");break;default:i.InspectionValuationResultText="";}if(i.InspSpecIsQuantitative===true){i.InspSpecIsQuantitative="1";}else{i.InspSpecIsQuantitative="0";}if(i.InspSpecIsLongTermInspection==="X"){i.InspSpecIsLongTermInspection="1";}else{i.InspSpecIsLongTermInspection="";}switch(i.InspSpecRecordingType){case"+":i.InspSpecRecordingType="1";break;case"-":i.InspSpecRecordingType="2";break;default:i.InspSpecRecordingType="";}switch(i.InspSpecCharcCategory){case"X":i.InspSpecCharcCategory="1";break;case"":i.InspSpecCharcCategory="2";break;default:i.InspSpecCharcCategory="";}switch(i.InspSpecResultCalculation){case"X":i.InspSpecResultCalculation="1";break;case"1":i.InspSpecResultCalculation="2";break;default:i.InspSpecResultCalculation="";}i.to_ResultDetails=JSON.parse(JSON.stringify(i.to_InspectionResultValue));i.to_History=i.to_InspCharcSubsetResults;if(!i.to_ResultDetails){i.to_ResultDetails={results:[]};}i.to_ResultDetails.results4Binding=[];Array.prototype.push.apply(i.to_ResultDetails.results4Binding,i.to_ResultDetails.results.filter(function(g){return g.Inspectionvaluationresult!=="F";}));},this);sap.ui.core.BusyIndicator.hide();this.oController.onCharInfoRequestSuccess(f,a,this.getOwnerComponent().getModel("i18n|sap.suite.ui.generic.template.ObjectPage|C_InspLotRsltRec").getResourceBundle().getText("TableHeadingItems"),this,d);}).bind(t),error:(function(E){sap.ui.core.BusyIndicator.hide();this._showErrorMessage(E);}).bind(this)});},getCharacValuationData:function(b){var t=this;var f=[];var o={};o=new sap.ui.model.Filter("InspectionLot",sap.ui.model.FilterOperator.EQ,b.InspectionLot);f.push(o);o=new sap.ui.model.Filter("InspPlanOperationInternalID",sap.ui.model.FilterOperator.EQ,b.InspPlanOperationInternalID);f.push(o);o=new sap.ui.model.Filter("InspectionCharacteristic",sap.ui.model.FilterOperator.EQ,b.InspectionCharacteristic);f.push(o);o=new sap.ui.model.Filter("InspectionSubsetInternalID",sap.ui.model.FilterOperator.EQ,b.InspectionSubsetInternalID);f.push(o);o=new sap.ui.model.Filter("IsActiveEntity",sap.ui.model.FilterOperator.EQ,b.IsActiveEntity);f.push(o);this.getOwnerComponent().getModel().read("/C_InspSubsetCharcResult",{filters:f,urlParameters:{"$skip":"0","$top":"10","$expand":"to_InspCharcSubsetResults"},success:(function(R){this.oController._showingChartForCharacHistory(R.results[0]);}).bind(t),error:(function(e){sap.ui.core.BusyIndicator.hide();this._showErrorMessage(e);}).bind(this)});},onLoseFocusData:function(p,a,t,T){var s=false;this.getView().setBusy(true);var d={};var b=this;$.each(p[0].value,function(i,c){if(b.oSavePayloadKeys.ignoreKeys.indexOf(i)===-1){d[i]=c;}});if(p[0].value.to_ResultDetails.results.length>0||p[0].value.to_InspectionResultValue.results.length>0){if(!a){s=false;}else{s=true;this._handleSingleResult(p[0].value,d,t,T);}}if(s===false){var P=this.getOwnerComponent().getModel().createKey("C_InspSubsetCharcResult",{InspectionLot:d.InspectionLot,InspectionSubsetInternalID:d.InspectionSubsetInternalID,InspPlanOperationInternalID:d.InspPlanOperationInternalID,InspectionCharacteristic:d.InspectionCharacteristic,DraftUUID:d.DraftUUID,IsActiveEntity:d.IsActiveEntity});P="/"+P;this.extensionAPI.getTransactionController().saveDraft(this._updateRRData(P,d));}},_updateRRData:function(p,d){this.getOwnerComponent().getModel().update(p,d,{success:$.proxy(function(R,o){this.getView().setBusy(false);this.hasChanges=false;this.objectPage2View=sap.ui.getCore().byId(this.resultRecordingPageId);if(this.objectPage2View){this.objectPage2View.byId("SaveButton").setEnabled(true);}},this),error:$.proxy(function(e){this.getView().setBusy(false);this.hasChanges=false;this.objectPage2View=sap.ui.getCore().byId(this.resultRecordingPageId);if(this.objectPage2View){this.objectPage2View.byId("SaveButton").setEnabled(true);}},this)});},_handleSingleResult:function(d,p,t,T){var a=false;this.onLoseFocusDataResponse=p;this.oDataFromLib=d;var b=this;var I=false;if(t.length>0){for(var j=0;j<this.oDataFromLib.to_InspectionResultValue.results.length;j++){I=false;for(var k=0;k<this.oDataFromLib.to_ResultDetails.results.length;k++){if(parseInt(this.oDataFromLib.to_ResultDetails.results[k].InspResultItemInternalID,10)===parseInt(this.oDataFromLib.to_InspectionResultValue.results[j].InspResultItemInternalID,10)){I=true;break;}}if(!I){this._handleDeleteSingleResult(this.oDataFromLib.to_InspectionResultValue.results[j]);this.oDataFromLib.to_InspectionResultValue.results.splice(j,1);j--;}}}if(T.length>0){var P=this.getOwnerComponent().getModel().createKey("C_InspSubsetCharcResult",{InspectionLot:this.oDataFromLib.InspectionLot,InspectionSubsetInternalID:this.oDataFromLib.InspectionSubsetInternalID,InspPlanOperationInternalID:this.oDataFromLib.InspPlanOperationInternalID,InspectionCharacteristic:this.oDataFromLib.InspectionCharacteristic,DraftUUID:this.oDataFromLib.DraftUUID,IsActiveEntity:this.oDataFromLib.IsActiveEntity});P="/"+P+"/to_InspectionResultValue";this._updateParentEntityForSingleResult(this.onLoseFocusDataResponse);for(var i=0;i<this.oDataFromLib.to_ResultDetails.results.length;i++){a=false;for(j=0;j<this.oDataFromLib.to_InspectionResultValue.results.length;j++){if(parseInt(this.oDataFromLib.to_ResultDetails.results[i].InspResultItemInternalID,10)===parseInt(this.oDataFromLib.to_InspectionResultValue.results[j].InspResultItemInternalID,10)){a=true;break;}}if(!a){var D={InspectionLot:this.oDataFromLib.to_ResultDetails.results[i].InspectionLot,InspectionSubsetInternalID:this.oDataFromLib.to_ResultDetails.results[i].InspectionSubsetInternalID,InspPlanOperationInternalID:this.oDataFromLib.to_ResultDetails.results[i].InspPlanOperationInternalID,InspectionCharacteristic:this.oDataFromLib.to_ResultDetails.results[i].InspectionCharacteristic,ParentDraftUUID:this.oDataFromLib.to_ResultDetails.results[i].DraftUUID,IsActiveEntity:this.oDataFromLib.to_ResultDetails.results[i].IsActiveEntity,InspectionResultMeasuredValue:Number(this.oDataFromLib.to_ResultDetails.results[i].InspectionResultMeasuredValue),InspectionResultOriginalValue:this.oDataFromLib.to_ResultDetails.results[i].InspectionResultOriginalValue,InspResultItemInternalID:""+this.oDataFromLib.to_ResultDetails.results[i].InspResultItemInternalID,InspectionValuationResult:this.oDataFromLib.to_ResultDetails.results[i].InspectionValuationResult,CharacteristicAttributeCode:this.oDataFromLib.to_ResultDetails.results[i].CharacteristicAttributeCode,CharacteristicAttributeCodeGrp:this.oDataFromLib.to_ResultDetails.results[i].CharacteristicAttributeCodeGrp};this.bSingleResultFlag=true;this.getOwnerComponent().getModel().create(P,D,{success:$.proxy(function(R){b.getView().setBusy(false);this.oDataFromLib.to_InspectionResultValue.results.push(R);},this),error:$.proxy(function(e){b.getView().setBusy(false);this._showErrorMessage(e);},this)});}}}},_updateParentEntityForSingleResult:function(d){var p=this.getOwnerComponent().getModel().createKey("C_InspSubsetCharcResult",{InspectionLot:d.InspectionLot,InspectionSubsetInternalID:d.InspectionSubsetInternalID,InspPlanOperationInternalID:d.InspPlanOperationInternalID,InspectionCharacteristic:d.InspectionCharacteristic,DraftUUID:d.DraftUUID,IsActiveEntity:d.IsActiveEntity});p="/"+p;this.extensionAPI.getTransactionController().saveDraft(this._updateRRData(p,d));},_handleDeleteSingleResult:function(d){var c=this.getOwnerComponent().getModel().createKey("C_InspSubsetResultValue",{InspectionLot:d.InspectionLot,InspectionSubsetInternalID:d.InspectionSubsetInternalID,InspPlanOperationInternalID:d.InspPlanOperationInternalID,InspectionCharacteristic:d.InspectionCharacteristic,InspResultValueInternalID:d.InspResultValueInternalID,DraftUUID:d.DraftUUID,IsActiveEntity:false});c="/"+c;d.InspectionResultAttribute="/";this.getView().setBusy(false);this.getOwnerComponent().getModel().update(c,d,{success:$.proxy(function(R,o){this.getView().setBusy(false);this.hasChanges=false;this.objectPage2View=sap.ui.getCore().byId(this.resultRecordingPageId);if(this.objectPage2View){this.objectPage2View.byId("SaveButton").setEnabled(true);}},this),error:$.proxy(function(e){this.getView().setBusy(false);this.hasChanges=false;this.objectPage2View=sap.ui.getCore().byId(this.resultRecordingPageId);if(this.objectPage2View){this.objectPage2View.byId("SaveButton").setEnabled(true);}},this)});},onInspPointBeforeRebind:function(e){var v=this.getView().getBindingContext().getObject();var o=v.InspectionOperations.split(",");var f={};var b=e.getParameter("bindingParams");f=new sap.ui.model.Filter("InspectionLot",sap.ui.model.FilterOperator.EQ,v.InspectionLot);b.filters.push(f);f=new sap.ui.model.Filter("IsActiveEntity",sap.ui.model.FilterOperator.EQ,true);b.filters.push(f);f=new sap.ui.model.Filter("IsActiveEntity",sap.ui.model.FilterOperator.EQ,false);b.filters.push(f);b.parameters.expand="DraftAdministrativeData";o.forEach(function(a){f=new sap.ui.model.Filter("InspectionOperation",sap.ui.model.FilterOperator.EQ,a);b.filters.push(f);});if(b.parameters.select){b.parameters.select=b.parameters.select+",InspSubsetUsageDcsnCodeGroup,DraftEntityLastChangeDateTime,DraftAdministrativeData/CreationDateTime,DraftAdministrativeData/LastChangeDateTime,DraftUUID,IsActiveEntity,InspSubsetTimeIntervalUnit,InspSubsetTimeInterval,InspPlanOperationInternalID,InspectionSubsetInternalID,InspectionLot,InspectionOperation,WorkCenter,InspSubsetUsageDcsnCode,InspSubsetUsageDcsnValuation,InspSubsetCharcOpenCount,InspSubsetCharcAcceptedCount,InspectionSubsetTime,InspectionSubsetDate,InspSubsetCharcRejectedCount,InspSubsetStatus,InspSubsetAcceptedCount,InspSubsetRejectedCount,DraftAdministrativeData/CreatedByUserDescription,DraftAdministrativeData/DraftIsProcessedByMe,DraftAdministrativeData/LastChangedByUserDescription,DraftAdministrativeData/DraftIsKeptByUser,DraftAdministrativeData/DraftUUID,DraftAdministrativeData/CreatedByUser";}else{b.parameters.select="InspSubsetUsageDcsnCodeGroup,DraftEntityLastChangeDateTime,DraftUUID,DraftAdministrativeData/CreationDateTime,DraftAdministrativeData/LastChangeDateTime,IsActiveEntity,InspSubsetTimeIntervalUnit,InspSubsetTimeInterval,InspPlanOperationInternalID,InspectionSubsetInternalID,InspectionLot,InspectionOperation,WorkCenter,InspSubsetUsageDcsnCode,InspSubsetUsageDcsnValuation,InspSubsetCharcOpenCount,InspSubsetCharcAcceptedCount,InspectionSubsetTime,InspectionSubsetDate,InspSubsetCharcRejectedCount,InspSubsetStatus,InspSubsetAcceptedCount,InspSubsetRejectedCount,DraftAdministrativeData/CreatedByUserDescription,DraftAdministrativeData/DraftIsProcessedByMe,DraftAdministrativeData/LastChangedByUserDescription,DraftAdministrativeData/DraftIsKeptByUser,DraftAdministrativeData/DraftUUID,DraftAdministrativeData/CreatedByUser";}b.parameters=b.parameters||{};var c=e.getSource().getTable().getColumns();c[0].setMergeFunctionName("getTitle");c[0].setMergeDuplicates(true);},onInspectionPointPress:function(e){var v=this.getView().getBindingContext().getObject();var R=e.getSource().getBindingContext().getObject();this._navigateToResultRecordingPage(R,v,true);},onInpectionPointEditPress:function(e){var v=this.getView().getBindingContext().getObject();var R=e.getSource().getBindingContext().getObject();if(R.DraftUUID==="00000000-0000-0000-0000-000000000000"){if(R.InspSubsetStatus==="1"||R.InspSubsetStatus==="2"){this._createIP(R,v,e);}else{this._onEditIP(R,v);}}else{this._navigateToResultRecordingPage(R,v,true);}},onValuationSelection:function(e){if(e.getParameter("selected")){var s=e.getSource().getBindingContext("valuationFacet").getObject();var d=this.getView().getBindingContext().getObject();var p=this.getOwnerComponent().getModel().createKey("C_InspSubsetRsltRec",{InspectionLot:d.InspectionLot,InspectionSubsetInternalID:d.InspectionSubsetInternalID,InspPlanOperationInternalID:d.InspPlanOperationInternalID,DraftUUID:d.DraftUUID,IsActiveEntity:false});p="/"+p;this.getOwnerComponent().getModel().setProperty(p+"/InspSubsetUsageDcsnCode",s.UsageDecisionCode);this.getOwnerComponent().getModel().setProperty(p+"/InspSubsetUsageDcsnCodeGroup",s.UsageDecisionCodeGroup);this.extensionAPI.getTransactionController().executeSideEffects();}},onPressCancelDraft:function(e){if(!this.DiscardDraftPopOver){this.DiscardDraftPopOver=sap.ui.xmlfragment("discardDraftPopover","i2d.qm.inspsubset.resultsrecords1.ext.fragment.DiscardPopOver",this);this.getView().addDependent(this.DiscardDraftPopOver);}var b=e.getSource();this.DiscardDraftPopOver.openBy(b);},onDiscardPress:function(){this.IpDeleted=false;var p=this.getView().getBindingContext().sPath;this.getOwnerComponent().getModel().remove(p,{success:$.proxy(function(R,o){var h=sap.ui.core.routing.History.getInstance();var P=h.getPreviousHash();if(P!==undefined){this.IpDeleted=true;window.history.go(-1);}else{var a=this.getOwnerComponent().getRouter();a.navTo("root",null,true);}},this),error:$.proxy(function(e){this.IpDeleted=false;this._showErrorMessage(e);},this)});},onPressSaveActive:function(e){var t=this;this.IpSaved=false;this.getView().setBusy(true);var d=this.getView().getBindingContext().getObject();var u={InspectionLot:d.InspectionLot,InspPlanOperationInternalID:d.InspPlanOperationInternalID,InspectionSubsetInternalID:d.InspectionSubsetInternalID,DraftUUID:d.DraftUUID,IsActiveEntity:d.IsActiveEntity};var p=this.extensionAPI.invokeActions("/C_InspSubsetRsltRecActivation",[],u);p.then(function(){t.getView().setBusy(false);var h=sap.ui.core.routing.History.getInstance();var P=h.getPreviousHash();if(P!==undefined){t.IpSaved=true;window.history.go(-1);}else{var R=t.getOwnerComponent().getRouter();R.navTo("root",null,true);}},function(E){t.IpSaved=false;t.getView().setBusy(false);});},onDraftMarkerPress:function(e){if(e.getParameters().type!=="LockedBy"){if(!this.DraftDetailsPopOver){this.DraftDetailsPopOver=sap.ui.xmlfragment("DraftDetailsPopOver","i2d.qm.inspsubset.resultsrecords1.ext.fragment.DraftPopOver",this);this.getView().addDependent(this.DraftDetailsPopOver);}this.DraftDetailsPopOver.setBindingContext(e.getSource().getBindingContext());var b=e.getSource();this.DraftDetailsPopOver.openBy(b);}else if(e.getParameters().type==="LockedBy"){if(!this.businessCardPopOver){this.businessCardPopOver=sap.ui.xmlfragment("businessCard","i2d.qm.inspsubset.resultsrecords1.ext.fragment.businessCardPopOver",this);this.businessCardPopOver.setBindingContext(e.getSource().getBindingContext());this.getView().addDependent(this.businessCardPopOver);}this.businessCardPopOver.setBindingContext(e.getSource().getBindingContext());this.businessCardPopOver.openBy(e.getSource());}},getCodeGroupDataForLibrary:function(d,c){var a=new C();var f=[];var o={};if(d.SelectedCodeSetPlant!==""){o=new sap.ui.model.Filter("SelectedCodeSetPlant",sap.ui.model.FilterOperator.EQ,d.SelectedCodeSetPlant);f.push(o);}if(d.SelectedCodeSet!==""){o=new sap.ui.model.Filter("SelectedCodeSet",sap.ui.model.FilterOperator.EQ,d.SelectedCodeSet);f.push(o);}o=new sap.ui.model.Filter("InspectionLot",sap.ui.model.FilterOperator.EQ,d.InspectionLot);f.push(o);o=new sap.ui.model.Filter("InspPlanOperationInternalID",sap.ui.model.FilterOperator.EQ,d.InspPlanOperationInternalID);f.push(o);o=new sap.ui.model.Filter("InspectionCharacteristic",sap.ui.model.FilterOperator.EQ,d.InspectionCharacteristic);f.push(o);this.getOwnerComponent().getModel().read("/C_Chargroupcode_Valuehelp",{filters:f,sorters:[new sap.ui.model.Sorter("CharacteristicAttributeCode",false)],success:(function(R){a.setvHMapModel(c,R);}).bind(this),error:(function(R){this._vHMap=R;}).bind(this)});},_ignoreFieldsForSmartTable:function(){var s=this.byId("inspectionPointSmartTable");var i="CreatedByUser,MaterialName,InspectionOperationForEdit,InspectionSubsetDate,InspectionSubsetInternalID,InspPlanOperationInternalID,SelectedCodeSet,InspectionLotForEdit,InspSpecAddlSeldCodeSetPlant,InspSubsetTimeInterval,InspSpecAdditionalSelectedSet,InspSubsetTimeIntervalUnit,InspectionSubsetSortKey,InspSubsetUsageDcsnCodeGroup,InspLotUsgeDcsnValuationText,InspSubsetUsageDcsnCode,InspSubsetUsageDcsnValuation,InspSbstTimeFldProperty,InspectionSubsetTime,InspectionSubsetDate,InspSbstLongNmbrFldProperty,InspSbstDateFldProperty,InspSubsetLongNumericKey,InspSubsetShortNumericKey,InspSbstShrtNmbrFldProperty,InspectionSubsetLongCharKey,InspSbstLongTxtFldProperty,InspectionSubsetShortCharKey,InspSbstShrtTxtFldProperty,LastChangeDate,InspSubsetFieldCombination,SelectedCodeSet,SelectedCodeSetPlant,LastChangedByUser,CreationTime,CreationDate,LastChangedByUser,CreatedByUser,LastChangeTime,LastChangeDate,LastChangedByUser,InspSubsetDateFieldName,InspSubsetTimeFieldName,InspSubsetCharcRejectedCount,InspSubsetCharcAcceptedCount,InspSubsetCharcOpenCount,InspSubsetRejectedCount,InspSubsetAcceptedCount,InspectionLot,InspectionOperations,Inspector,Material,Plant";s.setIgnoredFields(i);},_showErrorMessage:function(e,i){if(i){var j=JSON.parse(e);sap.m.MessageBox.error(j.error.message.value);}else{var c=!!this.getView().$().closest(".sapUiSizeCompact").length;sap.m.MessageBox.error(JSON.parse(e.responseText).error.message.value,{styleClass:c?"sapUiSizeCompact":""});}},onCloseDraftUnsavedChangesPopOver:function(e){if(!this.businessCardPopOver){this.businessCardPopOver=sap.ui.xmlfragment("businessCard","i2d.qm.inspsubset.resultsrecords1.ext.fragment.businessCardPopOver",this);this.getView().addDependent(this.businessCardPopOver);}this.businessCardPopOver.close();},_navigateToResultRecordingPage:function(d,v,i){if(v&&i===true){this.getView().getController().getOwnerComponent().getRouter().navTo("C_InspLotRsltRec/to_InspSubsetRsltRec",{keys1:"InspectionLot='"+d.InspectionLot+"',InspectionOperations='"+v.InspectionOperations+"'",keys2:"InspectionLot='"+d.InspectionLot+"',InspectionSubsetInternalID='"+d.InspectionSubsetInternalID+"',InspPlanOperationInternalID='"+d.InspPlanOperationInternalID+"',DraftUUID=guid'"+d.DraftUUID+"',IsActiveEntity="+d.IsActiveEntity},false);}else{this.getView().getController().getOwnerComponent().getRouter().navTo("C_InspLotRsltRec/to_InspSubsetRsltRec",{keys1:"InspectionLot='"+d.InspectionLot+"',InspectionOperations='"+v.InspectionOperations+"'",keys2:"InspectionLot='"+d.InspectionLot+"',InspectionSubsetInternalID='"+d.InspectionSubsetInternalID+"',InspPlanOperationInternalID='"+d.InspPlanOperationInternalID+"',DraftUUID=guid'"+d.DraftUUID+"',IsActiveEntity=false"},false);}}});});
